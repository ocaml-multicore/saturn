<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Skiplist (saturn.Saturn.Skiplist)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">saturn</a> &#x00BB; <a href="../index.html">Saturn</a> &#x00BB; Skiplist</nav><header class="odoc-preamble"><h1>Module <code><span>Saturn.Skiplist</span></code></h1><p>Lock-free non-resizable skiplist.</p><p>A skiplist is a probabilistic data structure that has an average logarithmic complexity for search and insertion operations. Like `Stdlib.Map`, it is an ordered collection.</p><p><b>Warning</b>: This skiplist is not resizable. It will, however, continue to work once the limit capacity is reached, but performance will decrease as the depth of the structure won't be enough to maintain logarithmic performance.</p><p><b>Sources</b>: This implementation is inspired by the algorithm in chapter 14 of <i>The Art of Multiprocessor Programming</i> book.</p></header><nav class="odoc-toc"><ul><li><a href="#api">API</a><ul><li><a href="#looking-up-bindings">Looking up bindings</a></li><li><a href="#adding-bindings">Adding bindings</a></li></ul></li><li><a href="#examples">Examples</a><ul><li><a href="#sequential-example">Sequential example</a></li><li><a href="#multicore-example">Multicore example</a></li></ul></li></ul></nav><div class="odoc-content"><h2 id="api"><a href="#api" class="anchor"></a>API</h2><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> <span>(!'k, !'v) t</span></span></code></div><div class="spec-doc"><p>The type of a lock-free skiplist containing bindings of keys of type <code>'k</code> to values of type <code>'v</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create"><a href="#val-create" class="anchor"></a><code><span><span class="keyword">val</span> create : <span><span class="optlabel">?max_height</span>:int <span class="arrow">&#45;&gt;</span></span> <span><span class="label">compare</span>:<span>(<span><span class="type-var">'k</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'k</span> <span class="arrow">&#45;&gt;</span></span> int)</span> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'k</span>, <span class="type-var">'v</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>create ~compare ()</code> creates a new empty skiplist where keys are ordered based on the given <code>compare</code> function.</p><p>Note that the polymorphic <code>Stdlib.compare</code> function has relatively high overhead and it is usually better to use a type specific <code>compare</code> function such as <code>Int.compare</code> or <code>String.compare</code>.</p><p>The optional <code>max_height</code> argument determines the maximum height of nodes in the skiplist and directly affects the performance of the skiplist. The current implementation does not adjust height automatically. <code>max_height</code> can be more than 30.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-max_height_of"><a href="#val-max_height_of" class="anchor"></a><code><span><span class="keyword">val</span> max_height_of : <span><span><span>(<span class="type-var">'k</span>, <span class="type-var">'v</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>max_height_of s</code> returns the maximum height of nodes of the skiplist <code>s</code> as specified to <a href="#val-create"><code>create</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-length"><a href="#val-length" class="anchor"></a><code><span><span class="keyword">val</span> length : <span><span><span>(<span class="type-var">'k</span>, <span class="type-var">'v</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>length s</code> computes the number of bindings in the skiplist <code>s</code>.</p></div></div><h3 id="looking-up-bindings"><a href="#looking-up-bindings" class="anchor"></a>Looking up bindings</h3><div class="odoc-spec"><div class="spec value anchored" id="val-find_opt"><a href="#val-find_opt" class="anchor"></a><code><span><span class="keyword">val</span> find_opt : <span><span><span>(<span class="type-var">'k</span>, <span class="type-var">'v</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'k</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'v</span> option</span></span></code></div><div class="spec-doc"><p><code>find_opt sl key</code> returns <code>Some</code> of the current binding of <code>key</code> in the skiplist <code>sl</code> or <code>None</code> if it does not exist.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-find_exn"><a href="#val-find_exn" class="anchor"></a><code><span><span class="keyword">val</span> find_exn : <span><span><span>(<span class="type-var">'k</span>, <span class="type-var">'v</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'k</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'v</span></span></code></div><div class="spec-doc"><p><code>find_exn sl key</code> returns the current binding of <code>key</code> in the skiplist <code>sl</code> or raises <code>Not_found</code> if no such binding exists.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <code>Not_found</code> <p>if no binding of <code>key</code> exists in the skiplist <code>sl</code>.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-mem"><a href="#val-mem" class="anchor"></a><code><span><span class="keyword">val</span> mem : <span><span><span>(<span class="type-var">'k</span>, <span class="type-var">'v</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'k</span> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>mem sl k</code> determines whether the skiplist <code>sl</code> contained a binding of <code>k</code>.</p></div></div><h3 id="adding-bindings"><a href="#adding-bindings" class="anchor"></a>Adding bindings</h3><div class="odoc-spec"><div class="spec value anchored" id="val-try_add"><a href="#val-try_add" class="anchor"></a><code><span><span class="keyword">val</span> try_add : <span><span><span>(<span class="type-var">'k</span>, <span class="type-var">'v</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'k</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'v</span> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>try_add sk key value</code> tries to add a new binding of <code>key</code> to <code>value</code> to the skiplist <code>sl</code>. Returns <code>true</code> on success and <code>false</code> if the skiplist already contains a binding for <code>key</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-try_remove"><a href="#val-try_remove" class="anchor"></a><code><span><span class="keyword">val</span> try_remove : <span><span><span>(<span class="type-var">'k</span>, <span class="type-var">'v</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'k</span> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>try_remove sl key</code> tries to remove a binding of <code>key</code> from the skiplist <code>sl</code>. Returns <code>true</code> on success and <code>false</code> if the skiplist does not contain a binding for <code>key</code>.</p></div></div><h2 id="examples"><a href="#examples" class="anchor"></a>Examples</h2><h3 id="sequential-example"><a href="#sequential-example" class="anchor"></a>Sequential example</h3><pre class="language-ocaml"><code># open Saturn.Skiplist
# let t = create ~compare:Int.compare ()
val t : (int, '_weak1) t = &lt;abstr&gt;
# try_add t 42 &quot;The answer&quot;
- : bool = true

# try_add t 101 &quot;Basics&quot;
- : bool = true

# find_opt t 42
- : string option = Some &quot;The answer&quot;

# try_add t 101 &quot;The basics&quot;
- : bool = false

# try_remove t 101
- : bool = true</code></pre><h3 id="multicore-example"><a href="#multicore-example" class="anchor"></a>Multicore example</h3><p><b>Note</b>: The barrier is used in this example solely to make the results more interesting by increasing the likelihood of parallelism. Spawning a domain is a costly operation, especially compared to the relatively small amount of work being performed here. In practice, using a barrier in this manner is unnecessary.</p><pre class="language-ocaml"><code># open Saturn.Skiplist
# let t : (int, int) t= create ~compare:Int.compare ()
val t : (int, int) t = &lt;abstr&gt;
# Random.self_init ()
- : unit = ()
# let barrier = Atomic.make 2
val barrier : int Atomic.t = &lt;abstr&gt;

# let work () = 
    Atomic.decr barrier;
    while Atomic.get barrier &gt; 0 do () done;
    for i = 0 to 10 do
        if Random.bool () then 
            try_add t i i |&gt; ignore
        else 
            try_remove t i |&gt; ignore
    done
val work : unit -&gt; unit = &lt;fun&gt;

# let d1 = Domain.spawn work
val d1 : unit Domain.t = &lt;abstr&gt;
# let d2 = Domain.spawn work
val d2 : unit Domain.t = &lt;abstr&gt;
# Domain.join d1; Domain.join d2
- : unit = ()</code></pre></div></body></html>
